#!/usr/bin/env python3
"""
Dojo CLI v2 - Your dev home
â›„ Simple, helpful, learns with you ðŸŒ¸
"""

import sys
from pathlib import Path

# Add lib to path
sys.path.insert(0, str(Path(__file__).parent / 'lib'))

from context import DojoContext
from ui import UI
from navigator import Navigator
from health import Health

def main():
    ctx = DojoContext()
    ui = UI(ctx)
    nav = Navigator(ctx)
    health = Health(ctx)
    
    if len(sys.argv) == 1:
        ui.show_dashboard()
    else:
        cmd = sys.argv[1]
        args = sys.argv[2:] if len(sys.argv) > 2 else []
        
        if cmd in ['help', 'h', '--help']:
            ui.show_help()
        elif cmd == 'dev':
            nav.run_dev(args[0] if args else None)
        elif cmd == 'code':
            nav.open_vscode(args[0] if args else None)
        elif cmd == 'open':
            nav.open_explorer(args[0] if args else None)
        elif cmd == 'goto':
            if not args:
                ui.console.print(" [error]Usage: dojo goto <name>[/]\n")
                return
            nav.goto(args[0])
        elif cmd == 'recent':
            nav.show_recent()
        elif cmd == 'ls':
            nav.list_projects(args[0] if args else None)
        elif cmd == 'where':
            nav.show_where()
        elif cmd == 'health':
            health.run_check()
        elif cmd == 'sync':
            health.sync_repos()
        elif cmd == 'clean':
            health.clean('--deep' in args)
        elif cmd == 'tutorial':
            ui.show_tutorial()
        elif cmd == 'examples':
            ui.show_examples()
        else:
            ui.console.print(f" [error]Unknown command: {cmd}[/]")
            ui.console.print(" [dim]Try 'dojo help' or just 'dojo'[/]\n")

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        print("\n")
        sys.exit(0)
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)
